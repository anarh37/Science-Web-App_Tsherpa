<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¼í•™ ì‹¤í—˜ ì‹œë®¬ë ˆì´í„°: ì§€ì‹œì•½ ë°˜ì‘ (ìµœì¢… ë ˆì´ì•„ì›ƒ)</title>
    
    <!-- êµ¬ê¸€ í°íŠ¸ 'Jua' ë¡œë“œ --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 'Jua' í°íŠ¸ ê¸°ë³¸ ì ìš© */
        body {
            font-family: 'Jua', sans-serif;
            user-select: none;
            min-height: 100vh;
            background-color: #f0f4f8; 
            
            /* [ìˆ˜ì •] body ìŠ¤íƒ€ì¼ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ ë˜ëŒë¦¬ê³ ,
               HTMLì˜ Tailwind í´ë˜ìŠ¤ê°€ ë ˆì´ì•„ì›ƒì„ ë‹´ë‹¹í•˜ë„ë¡ í•¨ */
        }

        /* ë©”ì¸ íƒ€ì´í‹€ */
        .main-title {
            font-size: 3.5rem; 
            font-weight: bold;
            color: #6666FF; 
            text-shadow: 
                -2px -2px 0 #fff, 
                 2px -2px 0 #fff,
                -2px  2px 0 #fff,
                 2px  2px 0 #fff,
                 4px 4px 0 rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        /* ë©”ì¸ íƒ­ (ì‹¤í—˜í•˜ê¸° / ê²°ê³¼ì •ë¦¬) */
        .main-tabs {
            width: 100%;
            /* [ìˆ˜ì •] ìµœëŒ€ ë„ˆë¹„ë¥¼ 820pxë¡œ ì œí•œ */
            max-width: 820px;
            display: grid; 
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .main-tab-btn {
            flex: 1;
            padding: 10px 15px;
            font-size: 1.5rem;
            font-weight: bold;
            border: 2px solid #b0c4de;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: #f0f4f8;
            color: #555;
            line-height: 1.2;
        }
        .main-tab-btn.active {
            background-color: #4a90e2;
            color: white;
            border-color: #3a75b6;
        }
        .main-tab-btn:disabled {
            background-color: #e0e6ed;
            color: #999;
            border-color: #dbe2eb;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .hidden {
            display: none !important;
        }

        /* ë“œë˜ê·¸ ì•¤ ë“œë¡­ ìŠ¤íƒ€ì¼ */
        .tool.dragging {
            cursor: grabbing;
            opacity: 0.5;
            transform: scale(1.1);
        }
        .ghost-tool {
            position: absolute;
            pointer-events: none;
            opacity: 0.7;
            z-index: 1000;
            transform: translate(-50%, -50%);
        }

        /* [ìˆ˜ì •] ì‹¤í—˜ ë„êµ¬ ì•„ì´ì½˜ */
        .tool {
            width: 150px; 
            height: 160px; 
            border-width: 1px;
            border-style: solid; 
            cursor: grab;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center; 
            gap: 8px;
            padding: 8px;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            box-sizing: border-box;
            background: #fff;
        }
        
        #tool-red-litmus { background-color: #fff; border-color: #efb8b8; }
        #tool-blue-litmus { background-color: #fff; border-color: #b8cdef; }
        #tool-phenolphthalein { background-color: #fff; border-color: #c0c0c0; }

        .tool img { object-fit: contain; }
        #tool-phenolphthalein img { width: 48px; height: 100px; } 

        /* [ìˆ˜ì •] ë¦¬íŠ¸ë¨¸ìŠ¤ ë„êµ¬ ëª¨ì–‘ */
        .litmus-tool-shape {
            width: 125px; 
            height: 60px; 
            border-radius: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em; 
            font-weight: bold;
            color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2) inset;
        }
        #tool-red-litmus .litmus-tool-shape { background-color: #FF6666; }
        #tool-blue-litmus .litmus-tool-shape { background-color: #6666FF; }

        .litmus-paper-result {
            width: 100px; 
            height: 45px; 
            border-radius: 18px;
            border: 1px solid #555;
            font-size: 0.9em;
            font-weight: bold;
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2) inset;
        }

        /* í˜ë†€í”„íƒˆë ˆì¸ 'ë°˜ì‘ ì—†ìŒ' í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .phen-no-result {
            width: 100px;
            height: 45px; 
            border-radius: 18px;
            border: 1px solid #ccc;
            font-size: 0.9em;
            font-weight: bold;
            color: #777;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
        }

        /* í™ˆíŒ(well) ê´€ë ¨ ìŠ¤íƒ€ì¼ */
        .well .label {
            position: absolute; 
            bottom: 15px; 
            width: 100%; 
            font-size: 1em; 
            font-weight: bold;
            color: #555;
            text-align: center;
        }

        .well .solution {
            width: 120px;  
            height: 120px; 
            margin: 10px auto 0; 
            border: 1px solid #d0d0d0; 
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative; 
            box-shadow: 0 0 5px rgba(0,0,0,0.05) inset;
        }

        .well {
            position: relative; 
            width: 125px; 
            height: 180px; 
            border: 1px solid #eee; 
            border-radius: 8px;
            background-color: #f9f9f9; 
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: flex-start; 
            padding-top: 5px; 
        }
        
        .well-plate {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 10px; 
            width: fit-content; 
            margin: 0 auto; 
        }

        /* ì „ì²´ ì»¨í…Œì´ë„ˆ */
        .container {
            width: 100%;
            max-width: 900px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 25px;
            display: flex; 
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* [ìˆ˜ì •] 2ë‹¨ ë ˆì´ì•„ì›ƒ (align-items: stretch ì¶”ê°€) */
        .lab-bench {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            /* [ìˆ˜ì •] ìµœëŒ€ ë„ˆë¹„ë¥¼ 820pxë¡œ ì œí•œí•˜ì—¬ ë‚´ë¶€ ì—¬ë°±ì´ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€ */
            max-width: 820px;
            align-items: stretch; /* [ì¶”ê°€] ë†’ì´ë¥¼ ê°™ê²Œ ë§Œë“¦ */
        }
        @media (max-width: 768px) {
            .lab-bench { 
                grid-template-columns: 1fr; 
                align-items: stretch;
            }
            .main-tabs { max-width: 100%; }
            .container { padding: 15px; }
            .main-title { font-size: 2.5rem; }
        }

        /* [ì¶”ê°€] ìš”ì•½(í€´ì¦ˆ) ì½˜í…ì¸ ì˜ ìµœëŒ€ ë„ˆë¹„ë„ ë™ì¼í•˜ê²Œ ì œí•œ */
        #summary-content {
            width: 100%;
            max-width: 820px;
        }

        .left-content-wrapper, .experiment-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        /* [ìˆ˜ì •] ì»¨í…ì¸  ë°•ìŠ¤ ë†’ì´ (height: 100% ì¶”ê°€) */
        .content-box {
            width: 100%;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 15px;
            height: 100%; /* [ì¶”ê°€] ë¶€ëª¨ ë†’ì´ë¥¼ ë”°ë¦„ */
        }
        /* [ìˆ˜ì •] ê²°ê³¼ ì •ë¦¬ íƒ­ ë†’ì´ */
        #summary-content .content-box {
            min-height: 620px; 
            height: auto; 
        }

        /* ì˜¤ë¥¸ìª½ ë°•ìŠ¤ */
        .experiment-area .content-box {
            display: block; 
            padding-top: 15px;
        }

        /* [ìˆ˜ì •] ì™¼ìª½ ë°•ìŠ¤ */
        .instructions-box {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            gap: 15px; 
            height: 100%; 
            padding-top: 10px; 
            padding-bottom: 10px;
        }
        
        /* ì„¹ì…˜ íƒ€ì´í‹€ (h2) */
        .section-title {
            font-size: 1.8em; 
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .section-title::before { content: 'ğŸ§ª'; margin-right: 8px; font-size: 1.2em; }
        .left-content-wrapper .section-title::before { content: 'ğŸ“–'; }

        /* ì¤‘ì²© íƒ­ (ì‹¤í—˜ 1/2) ìŠ¤íƒ€ì¼ */
        .exp-controls {
            display: flex;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #b0c4de;
        }
        .exp-btn {
            flex: 1;
            padding: 8px 10px;
            font-size: 1.2rem; /* [ìˆ˜ì •] 1.0rem -> 1.2rem (ì›ë˜ í°íŠ¸ í¬ê¸°ë¡œ ë³µì›) */
            font-weight: bold;
            background-color: #e0e6ed;
            color: #555;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            /* white-space: nowrap; [ì‚­ì œ] ë¹„ìœ¨ ìœ ì§€ë¥¼ ìœ„í•´ nowrap ì œê±° */
        }
        .exp-btn.active {
            background-color: #4a90e2;
            color: white;
        }
        .exp-btn:first-child { border-right: 1px solid #b0c4de; }

        /* [ìˆ˜ì •] ì‹¤í—˜ ë„êµ¬ ì˜ì—­ (ì—¬ë°± ì¶”ê°€) */
        .tools-area {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px; 
            justify-content: center;
            margin-top: 15px; 
            width: 100%;
        }
        .tool-item {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        /* [ìˆ˜ì •] ë„êµ¬ í…ìŠ¤íŠ¸ í¬ê¸° */
        .tool p {
            font-size: 1.0em; /* 0.9em -> 1.0em */
            color: #333;
            line-height: 1.2;
            white-space: nowrap;
            margin-top: 4px; /* ì•„ì´ì½˜ê³¼ì˜ ê°„ê²© */
        }
        #tool-item-phen {
            grid-column: span 2 / span 2;
            justify-self: center;
        }

        /* ê°€ì´ë“œ í…ìŠ¤íŠ¸ ë°•ìŠ¤ */
        .guide-text-box {
            font-size: 1.1rem;
            font-weight: bold;
            color: #004085; 
            padding: 10px 15px;
            background: #e0f2ff; 
            border: 2px solid #a7d9ff; 
            border-radius: 8px; 
            height: 80px;
            width: 100%;
            text-align: center; 
            display: flex;
            flex-direction: column; 
            align-items: center;
            justify-content: center;
            line-height: 1.3; 
            margin-top: 15px; 
            margin-bottom: 15px; 
        }
        .guide-text-box p {
            font-weight: normal;
            font-size: 1rem;
            margin-top: 5px;
        }

        /* ë¦¬ì…‹ ë²„íŠ¼ */
        #reset-button {
            width: 100%;
            margin-top: auto; 
        }
        
        /* ë¹„ìš°ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        #clear-plate-button {
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10px; /* í™ˆíŒê³¼ì˜ ê°„ê²© */
        }

        /* ê°€ì´ë“œ Pulse ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }
        .pulsing-guide {
            animation: pulse-animation 1.5s infinite;
            border-radius: 8px;
            box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); 
        }
        .tool.pulsing-guide { border-radius: 6px; }
        .exp-controls.pulsing-guide {
             animation: pulse-animation 1.5s infinite;
        }
        .exp-btn.pulsing-guide {
             animation: pulse-animation 1.5s infinite;
        }
        .main-tab-btn.pulsing-guide {
             animation: pulse-animation 1.5s infinite;
        }
        /* [ì‚­ì œ] ê°€ì´ë“œ í…ìŠ¤íŠ¸ ë°•ìŠ¤ í„ìŠ¤ ì œê±°
        .guide-text-box.pulsing-guide {
             animation: pulse-animation 1.5s infinite;
        }
        */


        /* ì´ë¯¸ì§€/ì˜¤ë””ì˜¤ Fallback */
        img {
            background-color: #eee;
            min-height: 40px; 
            display: inline-block;
        }
         #tool-phenolphthalein img {
             /* [ìˆ˜ì •] onerror ì†ì„±ì„ HTML íƒœê·¸ì—ì„œ ì§ì ‘ ì„¤ì • (CSSì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ) */
         }

        /* --- í€´ì¦ˆ ìŠ¤íƒ€ì¼ --- */
        
        /* í€´ì¦ˆ ë¼ë²¨ í’€ (ê°€ë¡œ ì •ë ¬) */
        #quiz-label-pool {
            display: flex;
            flex-direction: row; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f0f4f8;
            border-radius: 8px;
        }
        /* í€´ì¦ˆ ë¼ë²¨ (í¬ê¸° ìë™) */
        .summary-label {
            padding: 8px 16px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 20px;
            background-color: #fff;
            border: 2px solid #b0c4de;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            cursor: grab;
            transition: all 0.2s;
            width: auto; 
            max-width: none; 
            text-align: center;
            margin: 5px; 
        }
        .summary-label.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #c3e6cb; 
        }
        /* í…Œì´ë¸” ì…€ ë†’ì´/íŒ¨ë”© */
        .summary-table th, .summary-table td {
            border: 1px solid #c3e6cb;
            padding: 8px; 
            text-align: center;
            vertical-align: top;
            height: auto; 
        }
        .summary-table th {
            background-color: #e9f5e9; 
            font-size: 1.1rem;
        }
        .summary-table .sub-header {
            font-weight: bold;
            font-size: 1rem;
            vertical-align: middle;
            padding: 8px; 
        }
        /* ë“œë¡­ì¡´ ë†’ì´ */
        .summary-drop-zone {
            min-height: 50px; 
            height: 100%;
            width: 100%;
            border: 2px dashed #ccc;
            border-radius: 8px;
            background-color: #fafafa;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            color: #999;
            transition: all 0.2s;
        }
        .summary-drop-zone.drag-over {
            background-color: #e0f2ff;
            border-color: #4a90e2;
        }
        .summary-drop-zone.filled {
            background-color: #e8f5e9;
            border-color: #4caf50;
            border-style: solid;
            color: #111;
            font-weight: bold;
            font-size: 1rem;
            padding: 5px;
            line-height: 1.2;
        }
        .ghost-label {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            z-index: 1001;
            transform: translate(-50%, -50%);
            padding: 8px 16px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 20px;
            background-color: #fff;
            border: 2px solid #b0c4de;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* í€´ì¦ˆ ì°¸ê³ ìš© ë¯¸ë‹ˆ í”Œë ˆì´íŠ¸ ìŠ¤íƒ€ì¼ */
        #quiz-results-display {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #eee;
            flex-wrap: wrap; 
        }
        .mini-plate {
            width: 32%;
            min-width: 120px; 
            text-align: center;
            margin-bottom: 10px; 
        }
        .mini-plate-title {
            font-size: 0.9rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .mini-well-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            border: 1px solid #ddd;
            background-color: #fff;
            padding: 4px;
            border-radius: 4px;
        }
        /* [NEW] ë¯¸ë‹ˆ í™ˆíŒìš© ë¼ë²¨ */
        .mini-well-container {
            text-align: center;
        }
        .mini-well-label {
            font-size: 0.75rem; /* 12px */
            font-weight: bold;
            color: #333;
            margin-top: 2px;
            line-height: 1;
        }
        .mini-well {
            width: 100%;
            padding-top: 100%; /* ì •ì‚¬ê°í˜• ë¹„ìœ¨ */
            position: relative;
            border: 1px solid #ccc;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            overflow: hidden;
        }
        .mini-well-inner {
            /* [ìˆ˜ì •] ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ CSS */
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            /* [ìˆ˜ì •] í…ìŠ¤íŠ¸ê°€ ìˆëŠ” ìš”ì†Œì˜ ìŠ¤íƒ€ì¼ */
            width: 90%; 
            height: 40%; 
            border-radius: 10px; 
            border: 1px solid #555; 
            font-size: 0.6rem; 
            color: white;
        }
        
        /* ë¶‰ì€ìƒ‰ ë¦¬íŠ¸ë¨¸ìŠ¤ ê²°ê³¼ */
        .mini-well.r-acid { background-color: #f9f9f9; }
        .mini-well.r-acid .mini-well-inner { background-color: #FF6666; border-color: #555; color: white;}
        .mini-well.r-base { background-color: #f9f9f9; }
        .mini-well.r-base .mini-well-inner { background-color: #6666FF; border-color: #555; color: white;}
        
        /* í‘¸ë¥¸ìƒ‰ ë¦¬íŠ¸ë¨¸ìŠ¤ ê²°ê³¼ */
        .mini-well.b-acid { background-color: #f9f9f9; }
        .mini-well.b-acid .mini-well-inner { background-color: #FF6666; border-color: #555; color: white;}
        .mini-well.b-base { background-color: #f9f9f9; }
        .mini-well.b-base .mini-well-inner { background-color: #6666FF; border-color: #555; color: white;}

        /* í˜ë†€í”„íƒˆë ˆì¸ ê²°ê³¼ */
        .mini-well.p-acid { background-color: #f9f9f9; }
        .mini-well.p-acid .mini-well-inner { background-color: transparent; border-color: #ccc; color: #777;}
        /* [ìˆ˜ì •] í˜ë†€ ë² ì´ìŠ¤ëŠ” inner divê°€ ì•„ë‹Œ, well ìì²´ê°€ ì¹ í•´ì§ */
        .mini-well.p-base { background-color: #ec4899; } 
        .mini-well.p-base .mini-well-inner {
            display: none; /* í•‘í¬ìƒ‰ì¼ë•ŒëŠ” innerê°€ ë³´ì¼ í•„ìš” ì—†ìŒ */
        }
        
        /* [NEW] mini-well-inner í…ìŠ¤íŠ¸ ì¶”ê°€ (HTML ëŒ€ì‹  CSSë¡œ) */
        .mini-well.r-acid .mini-well-inner::before { content: 'ë³€í™” ì—†ìŒ'; }
        .mini-well.r-base .mini-well-inner::before { content: 'í‘¸ë¥¸ìƒ‰'; }
        .mini-well.b-acid .mini-well-inner::before { content: 'ë¶‰ì€ìƒ‰'; }
        .mini-well.b-base .mini-well-inner::before { content: 'ë³€í™” ì—†ìŒ'; }
        .mini-well.p-acid .mini-well-inner::before { content: 'ë°˜ì‘ ì—†ìŒ'; }

    </style>
</head>
<!-- body í´ë˜ìŠ¤ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ -->
<body class="bg-gray-100 p-8 flex flex-col items-center">

    <!-- H1 (ì œëª©)ì€ container ë°–ì— -->
    <h1 class="main-title mb-6">
        ì§€ì‹œì•½ ìƒ‰ê¹” ë³€í™” ì‹¤í—˜
    </h1>

    <div class="container">

        <div class="main-tabs">
            <button id="main-tab-experiment" class="main-tab-btn active">ğŸ”¬ ì‹¤í—˜í•˜ê¸°</button>
            <button id="main-tab-summary" class="main-tab-btn" disabled>ğŸ“ ê²°ê³¼ ì •ë¦¬</button>
        </div>

        <!-- [ìˆ˜ì •] ê¹¨ì¡Œë˜ HTML êµ¬ì¡°ë¥¼ ì˜¬ë°”ë¥¸ 2ë‹¨ ë ˆì´ì•„ì›ƒìœ¼ë¡œ ë³µì› -->
        <div id="experiment-content" class="lab-bench">
            
            <!-- ì™¼ìª½ ì»¬ëŸ¼ (ë„êµ¬) -->
            <div class="left-content-wrapper">
                <h2 class="section-title">ì‚¬ìš© ë°©ë²• ë° ë„êµ¬</h2>
                
                <div class="content-box instructions-box">
                    
                    <div class="exp-controls">
                        <button id="exp-tab-litmus" class="exp-btn active">ë¦¬íŠ¸ë¨¸ìŠ¤ ì‹¤í—˜</button>
                        <button id="exp-tab-phen" class="exp-btn">í˜ë†€í”„íƒˆë ˆì¸ ì‹¤í—˜</button>
                    </div>

                    <div id="tools-area" class="tools-area">
                        <div class="tool-item" id="tool-item-red-litmus">
                            <div class="tool" id="tool-red-litmus" draggable="true">
                                <div class="litmus-tool-shape">ë¶‰ì€ìƒ‰</div>
                                <p>ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´</p> 
                            </div>
                        </div>
                        
                        <div class="tool-item" id="tool-item-blue-litmus">
                            <div class="tool" id="tool-blue-litmus" draggable="true">
                                <div class="litmus-tool-shape">í‘¸ë¥¸ìƒ‰</div>
                                <p>ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´</p> 
                            </div>
                        </div>
                        
                        <div class="tool-item hidden" id="tool-item-phen">
                            <div class="tool" id="tool-phenolphthalein" draggable="true">
                                <img src="phenolphthalein.png" alt="í˜ë†€í”„íƒˆë ˆì¸ ìš©ì•¡" onerror="this.onerror=null; this.src='https://placehold.co/48x100/f0f0f0/c0c0c0?text=Phen';">
                                <p>í˜ë†€í”„íƒˆë ˆì¸ ìš©ì•¡</p> 
                            </div>
                        </div>
                    </div>

                    <div id="guide-text-box" class="guide-text-box">
                        ë„êµ¬ë¥¼ í™ˆíŒì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”.
                    </div>

                    <button id="reset-button" class="px-6 py-3 text-xl font-bold text-white bg-red-500 rounded-lg shadow-md cursor-pointer hover:bg-red-600 transition-colors">
                        ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°
                    </button>
                </div>
            </div>

            <!-- [ìˆ˜ì •] ì˜¤ë¥¸ìª½ ì»¬ëŸ¼ (ì‹¤í—˜íŒ) -->
            <div class="experiment-area">
                <h2 class="section-title" id="plate-title">ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´ ì‹¤í—˜íŒ</h2>
                
                <div class="content-box">
                    
                    <button id="clear-plate-button" class="text-xl px-6 py-2 font-bold text-gray-700 bg-gray-200 rounded-lg shadow-sm hover:bg-gray-300 transition-colors">
                        í˜„ì¬ ì‹¤í—˜íŒ ë¹„ìš°ê¸°
                    </button>

                    <div class="well-plate" id="litmus-plate"> 
                        
                        <div class="well" data-type="acid" data-solution="vinegar" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution"></div>
                            <div class="label">ì‹ì´ˆ</div>
                        </div>
                        <div class="well" data-type="acid" data-solution="carbonated-water" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution"></div>
                            <div class="label">íƒ„ì‚°ìˆ˜</div>
                        </div>
                        <div class="well" data-type="base" data-solution="limewater" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution"></div>
                            <div class="label">ì„íšŒìˆ˜</div>
                        </div>
                        <div class="well" data-type="acid" data-solution="hydrochloric-acid" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution"></div>
                            <div class="label">ë¬½ì€ ì—¼ì‚°</div>
                        </div>
                        <div class="well" data-type="base" data-solution="glass-cleaner" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution bg-cyan-100"></div>
                            <div class="label">ìœ ë¦¬ ì„¸ì •ì œ</div>
                        </div>
                        <div class="well" data-type="base" data-solution="sodium-hydroxide" data-tested-red="false" data-tested-blue="false" data-tested-phen="false">
                            <div class="solution"></div>
                            <div class="label">ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨</div>
                        </div>
                    </div>
                </div>
            </div>

        </div> <!-- /#experiment-content (í•˜ë‚˜ì˜ divë¡œ ë³µì›ë¨) -->
        
        <!-- [ìˆ˜ì •] IDì™€ í´ë˜ìŠ¤ë¥¼ ëª¨ë‘ ê°€ì§ -->
        <div id="summary-content" class="hidden">
            <div class="content-box">
                <!-- [ìˆ˜ì •] 'í€´ì¦ˆ' ë‹¨ì–´ ì‚­ì œ --><h2 class="section-title text-center text-3xl mb-4">ğŸ”¬ ì‹¤í—˜ ê²°ê³¼ ì •ë¦¬</h2>
                
                <!-- [ìˆ˜ì •] ê°€ì´ë“œ í…ìŠ¤íŠ¸ ìœ„ì¹˜ ë³€ê²½ --><div id="quiz-guide-text" class="text-center text-lg mb-4 text-blue-800">
                    ì‹¤í—˜ ê²°ê³¼ë¥¼ ë³´ê³ , ì•Œë§ì€ <span class="font-bold text-gray-700">'ìš©ì•¡ ë¬¶ìŒ'</span> ì¹´ë“œë¥¼ ë¹ˆì¹¸ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”!
                </div>

                <!-- [ìˆ˜ì •] ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€ì— ë§ê²Œ ìŠ¤íƒ€ì¼ ë³€ê²½ --><div id="quiz-results-display">
                    <div class="mini-plate">
                        <div class="mini-plate-title">ë¶‰ì€ìƒ‰ ë¦¬íŠ¸ë¨¸ìŠ¤ ê²°ê³¼</div>
                        <!-- [ìˆ˜ì •] HTML êµ¬ì¡° ë³€ê²½ -->
                        <div class="mini-well-grid">
                            <div class="mini-well-container">
                                <div class="mini-well r-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì‹ì´ˆ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well r-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">íƒ„ì‚°ìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well r-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì„íšŒìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well r-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ì—¼ì‚°</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well r-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ìœ ë¦¬ ì„¸ì •ì œ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well r-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨</div>
                            </div>
                        </div>
                    </div>
                    <div class="mini-plate">
                        <div class="mini-plate-title">í‘¸ë¥¸ìƒ‰ ë¦¬íŠ¸ë¨¸ìŠ¤ ê²°ê³¼</div>
                        <!-- [ìˆ˜ì •] HTML êµ¬ì¡° ë³€ê²½ -->
                        <div class="mini-well-grid">
                            <div class="mini-well-container">
                                <div class="mini-well b-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì‹ì´ˆ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well b-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">íƒ„ì‚°ìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well b-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì„íšŒìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well b-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ì—¼ì‚°</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well b-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ìœ ë¦¬ ì„¸ì •ì œ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well b-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨</div>
                            </div>
                        </div>
                    </div>
                    <div class="mini-plate">
                        <div class="mini-plate-title">í˜ë†€í”„íƒˆë ˆì¸ ê²°ê³¼</div>
                        <!-- [ìˆ˜ì •] HTML êµ¬ì¡° ë³€ê²½ -->
                        <div class="mini-well-grid">
                            <div class="mini-well-container">
                                <div class="mini-well p-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì‹ì´ˆ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well p-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">íƒ„ì‚°ìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well p-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ì„íšŒìˆ˜</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well p-acid"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ì—¼ì‚°</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well p-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ìœ ë¦¬ ì„¸ì •ì œ</div>
                            </div>
                            <div class="mini-well-container">
                                <div class="mini-well p-base"><div class="mini-well-inner"></div></div>
                                <div class="mini-well-label">ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="quiz-label-pool">
                    <div class="summary-label" draggable="true" data-answer="acid">ì‹ì´ˆ, íƒ„ì‚°ìˆ˜, ë¬½ì€ ì—¼ì‚°</div>
                    <div class="summary-label" draggable="true" data-answer="base">ì„íšŒìˆ˜, ìœ ë¦¬ ì„¸ì •ì œ, ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨</div>
                </div>

                <table class="summary-table">
                    <thead>
                        <tr>
                            <th colspan="2">ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´</th>
                            <th colspan="2">í˜ë†€í”„íƒˆë ˆì¸ ìš©ì•¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="sub-header">í‘¸ë¥¸ìƒ‰ â†’ ë¶‰ì€ìƒ‰</td>
                            <td class="sub-header">ë¶‰ì€ìƒ‰ â†’ í‘¸ë¥¸ìƒ‰</td>
                            <td class="sub-header">ë³€í™” ì—†ìŒ</td>
                            <td class="sub-header">ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë³€í•¨</td>
                        </tr>
                        <tr>
                            <td>
                                <div class="summary-drop-zone" data-answer="acid">ì´ê³³ì— ë“œë¡­</div>
                            </td>
                            <td>
                                <div class="summary-drop-zone" data-answer="base">ì´ê³³ì— ë“œë¡­</div>
                            </td>
                            <td>
                                <div class="summary-drop-zone" data-answer="acid">ì´ê³³ì— ë“œë¡­</div>
                            </td>
                            <td>
                                <div class="summary-drop-zone" data-answer="base">ì´ê³³ì— ë“œë¡­</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>


    </div> <!-- /.container --><!-- ì˜¤ë””ì˜¤ íŒŒì¼ì€ ì‹¤ì œ ê²½ë¡œë¡œ ëŒ€ì²´í•´ì•¼ í•©ë‹ˆë‹¤. --><audio id="water-sound" src="water.mp3" preload="auto"></audio>
    <audio id="reaction-sound" src="reaction.mp3" preload="auto"></audio>

    <script>
        // --- [0] DOM ìš”ì†Œ ë³€ìˆ˜ (ì „ì—­ ì„ ì–¸) ---
        let waterSound, reactionSound;
        let toolsArea;
        let currentExperiment = 'litmus';
        
        let mainTabExperiment, mainTabSummary;
        let experimentContent, summaryContent;
        let expTabLitmus, expTabPhen;
        let toolItemRedLitmus, toolItemBlueLitmus, toolItemPhen;
        let mainPlate; 
        let guideTextBox;
        let plateTitle;
        let clearPlateButton; 
        let wells; 
        let resetButton;
        let tools; 

        let redLitmusUsedCount = 0;
        let blueLitmusUsedCount = 0;
        let phenUsedCount = 0;
        const allWells = 6;

        let quizLabels, quizDropZones, quizLabelPool, quizGuideText;
        let draggedQuizLabel = null;
        let quizGhostElement = null;
        let correctQuizAnswers = 0;
        
        let draggedToolId = null;
        let draggedToolElement = null;
        let ghostElement = null;
        let isTouchDragging = false;


        // --- [1] ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

        function playSound(sound) {
            if (sound) {
                // ì´ì „ì— ì¬ìƒ ì¤‘ì´ë˜ ì†Œë¦¬ë¥¼ ë©ˆì¶”ê³  ì²˜ìŒìœ¼ë¡œ ë˜ëŒë¦¼
                sound.pause();
                sound.currentTime = 0;
                
                const playPromise = sound.play();
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // iOS/Chrome ë“±ì—ì„œ ìë™ ì¬ìƒ ì •ì±…ì„ ë§Œì¡±ì‹œí‚¤ê¸° ìœ„í•´ ë³¼ë¥¨ ì¡°ì ˆ
                        sound.volume = 0.5;
                    }).catch(error => {
                        // ìë™ ì¬ìƒì´ ì°¨ë‹¨ëœ ê²½ìš° ì½˜ì†”ì— ë¡œê·¸ë§Œ ë‚¨ê¹€ (ì‚¬ìš©ì ê²½í—˜ì„ í•´ì¹˜ì§€ ì•Šê¸° ìœ„í•´)
                        console.info("ì˜¤ë””ì˜¤ ìë™ ì¬ìƒì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ìƒí˜¸ì‘ìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                    });
                }
            }
        }

        function clearAllPulses() {
            document.querySelectorAll('.pulsing-guide').forEach(el => {
                el.classList.remove('pulsing-guide');
            });
            document.querySelector('.exp-controls')?.classList.remove('pulsing-guide');
            document.getElementById('exp-tab-litmus')?.classList.remove('pulsing-guide');
            document.getElementById('exp-tab-phen')?.classList.remove('pulsing-guide');
            mainTabSummary?.classList.remove('pulsing-guide');
        }
        
        function updateGuideText(message, p_message = "") {
            const cleanMessage = message.replace(" í€´ì¦ˆ", "");
            const targetBox = (mainTabSummary.classList.contains('active')) ? quizGuideText : guideTextBox;
            if (targetBox) {
                if (targetBox.id === 'quiz-guide-text') {
                    targetBox.innerHTML = `<b>${cleanMessage}</b> ${p_message.replace(/<br>/g, ' ')}`;
                } else {
                    targetBox.innerHTML = `<b>${cleanMessage}</b>${p_message ? `<p class="mt-1">${p_message}</p>` : ""}`;
                }
            }
        }

        // [ìˆ˜ì •] ê°€ì´ë“œ ë¡œì§ (ì¹´ìš´íŠ¸ ë²„ê·¸ ìˆ˜ì •)
        function updateGuide(state) {
            clearAllPulses();
            
            const isLitmusDone = (redLitmusUsedCount === allWells && blueLitmusUsedCount === allWells);
            const isPhenDone = (phenUsedCount === allWells);

            if (state === 'check_completion') {
                if (isLitmusDone && isPhenDone) {
                    state = 'all_done';
                }
                else if (currentExperiment === 'litmus') {
                    if (redLitmusUsedCount < allWells) state = 'pulse_red';
                    else if (blueLitmusUsedCount < allWells) state = 'pulse_blue';
                    else state = 'litmus_done';
                } 
                else { // phen
                    if (phenUsedCount < allWells) state = 'pulse_phen';
                    else if (!isLitmusDone) state = 'phen_done_goto_litmus'; 
                    else state = 'all_done';
                }
            }

            switch (state) {
                case 'init': 
                    if(document.readyState === 'loading') return; 
                    updateGuide('check_completion');
                    return;
                
                case 'pulse_red':
                    updateGuideText("1. ë¦¬íŠ¸ë¨¸ìŠ¤ ì‹¤í—˜", "ë¶‰ì€ìƒ‰ ì¢…ì´ë¥¼ í™ˆíŒì— ëŒì–´ë‹¤ ë†“ê³ <br>ìƒ‰ê¹” ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.");
                    document.getElementById('tool-red-litmus').classList.add('pulsing-guide');
                    break;
                case 'pulse_blue':
                    updateGuideText("1. ë¦¬íŠ¸ë¨¸ìŠ¤ ì‹¤í—˜", "ë¶‰ì€ìƒ‰ ì™„ë£Œ! ì´ì œ í‘¸ë¥¸ìƒ‰ ì¢…ì´ë¡œ<br>ìƒ‰ê¹” ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.");
                    document.getElementById('tool-blue-litmus').classList.add('pulsing-guide');
                    break;
                case 'pulse_phen':
                    updateGuideText("2. í˜ë†€í”„íƒˆë ˆì¸ ì‹¤í—˜", "ì ì ë³‘ì„ í™ˆíŒì— ëŒì–´ë‹¤ ë†“ê³ <br>ìƒ‰ê¹” ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.");
                    document.getElementById('tool-phenolphthalein').classList.add('pulsing-guide');
                    break;
                
                case 'litmus_done':
                    updateGuideText("ë¦¬íŠ¸ë¨¸ìŠ¤ ì‹¤í—˜ ì™„ë£Œ!", "ëª¨ë“  ë°˜ì‘ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.<br>'í˜ë†€í”„íƒˆë ˆì¸' íƒ­ì„ ëˆ„ë¥´ì„¸ìš”.");
                    document.getElementById('exp-tab-phen').classList.add('pulsing-guide');
                    break;
                case 'phen_done_goto_litmus':
                    updateGuideText("í˜ë†€í”„íƒˆë ˆì¸ ì‹¤í—˜ ì™„ë£Œ!", "ëª¨ë“  ë°˜ì‘ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.<br>'ë¦¬íŠ¸ë¨¸ìŠ¤' íƒ­ì„ ëˆ„ë¥´ì„¸ìš”.");
                    document.getElementById('exp-tab-litmus').classList.add('pulsing-guide');
                    break;
                
                case 'all_done': 
                    updateGuideText("ëª¨ë“  ì‹¤í—˜ ì™„ë£Œ!", "'ê²°ê³¼ ì •ë¦¬' íƒ­ì„ ëˆŒëŸ¬<br>í•™ìŠµí•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.");
                    if(mainTabSummary.disabled) {
                        mainTabSummary.disabled = false;
                        mainTabSummary.classList.add('pulsing-guide');
                    }
                    break;

                case 'reaction':
                    updateGuideText("ë°˜ì‘ í™•ì¸!", "ë‹¤ë¥¸ í™ˆì—ë„ ì‹¤í—˜í•´ ë³´ì„¸ìš”.<br>ìƒ‰ê¹” ë³€í™”ë¥¼ ì˜ ê´€ì°°í•˜ì„¸ìš”.");
                    break;
                
                default:
                     if (currentExperiment === 'litmus') {
                         updateGuideText("1. ë¦¬íŠ¸ë¨¸ìŠ¤ ì‹¤í—˜", "ë¶‰ì€ìƒ‰/í‘¸ë¥¸ìƒ‰ ì¢…ì´ë¥¼ í™ˆíŒì— ëŒì–´ë‹¤ ë†“ê³ <br>ìƒ‰ê¹” ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.");
                     } else {
                         updateGuideText("2. í˜ë†€í”„íƒˆë ˆì¸ ì‹¤í—˜", "ì ì ë³‘ì„ í™ˆíŒì— ëŒì–´ë‹¤ ë†“ê³ <br>ìƒ‰ê¹” ë³€í™”ë¥¼ ê´€ì°°í•˜ì„¸ìš”.");
                     }
            }
        } 


        // --- [2] íƒ­ ì „í™˜ ë¡œì§ ---

        function showMainTab(tabName) {
            if (mainTabSummary.disabled && tabName === 'summary') return;
            
            mainTabExperiment.classList.toggle('active', tabName === 'experiment');
            mainTabSummary.classList.toggle('active', tabName === 'summary');

            if (tabName === 'summary') {
                mainTabSummary.classList.remove('pulsing-guide');
                if (correctQuizAnswers < 4) {
                    updateGuideText("ì‹¤í—˜ ê²°ê³¼ë¥¼ ë³´ê³ , ì•Œë§ì€ ìš©ì•¡ ë¬¶ìŒì„ ë¹ˆì¹¸ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”!", "");
                } else {
                    updateGuideText("ê²°ê³¼ ì •ë¦¬ ì™„ë£Œ! ëª¨ë“  ì •ë‹µì„ ë§í˜”ìŠµë‹ˆë‹¤! ì°¸ ì˜í–ˆì–´ìš”!", "");
                }
            }
            
            experimentContent.classList.toggle('hidden', tabName !== 'experiment');
            summaryContent.classList.toggle('hidden', tabName !== 'summary');
            
            if (tabName === 'experiment') {
                 updateGuide('init'); 
            }
        }

        function switchExperiment(expType) {
            if (currentExperiment === expType) return;
            currentExperiment = expType;

            if (expType === 'litmus') {
                expTabLitmus.classList.add('active');
                expTabPhen.classList.remove('active');
                mainPlate.id = 'litmus-plate';
                plateTitle.innerText = "ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´ ì‹¤í—˜íŒ";
                
                toolItemRedLitmus.classList.remove('hidden');
                toolItemBlueLitmus.classList.remove('hidden');
                toolItemPhen.classList.add('hidden');

            } else { // 'phen'
                expTabLitmus.classList.remove('active');
                expTabPhen.classList.add('active');
                mainPlate.id = 'phen-plate';
                plateTitle.innerText = "í˜ë†€í”„íƒˆë ˆì¸ ì‹¤í—˜íŒ";
                
                toolItemRedLitmus.classList.add('hidden');
                toolItemBlueLitmus.classList.add('hidden');
                toolItemPhen.classList.remove('hidden');
            }
            
            resetExperiment(false); 
            updateGuide('init'); 
        }

        // --- [3] í•µì‹¬ ì‹¤í—˜ ë¡œì§ ---
        function runExperiment(targetElement, toolId) {
            const targetWell = targetElement.closest('.well');
            if (!targetWell || !toolId) return;

            const solutionDiv = targetWell.querySelector('.solution');
            const solutionType = targetWell.dataset.type;
            const plateId = targetWell.closest('.well-plate').id; 

            let changeOccurred = false;
            let justTestedNew = false; 

            if (plateId === 'litmus-plate') {
                if (toolId === 'tool-red-litmus') {
                    if (targetWell.dataset.testedRed !== 'true') {
                        targetWell.dataset.testedRed = 'true';
                        if(redLitmusUsedCount < allWells) redLitmusUsedCount++;
                        justTestedNew = true;
                    }
                    changeOccurred = showLitmusResult(solutionDiv, toolId, solutionType);
                } else if (toolId === 'tool-blue-litmus') {
                    if (targetWell.dataset.testedBlue !== 'true') {
                        targetWell.dataset.testedBlue = 'true';
                        if(blueLitmusUsedCount < allWells) blueLitmusUsedCount++;
                        justTestedNew = true;
                    }
                    changeOccurred = showLitmusResult(solutionDiv, toolId, solutionType);
                }
            } else if (plateId === 'phen-plate') {
                if (toolId === 'tool-phenolphthalein') {
                    if (targetWell.dataset.testedPhen !== 'true') {
                        targetWell.dataset.testedPhen = 'true';
                        if(phenUsedCount < allWells) phenUsedCount++;
                        justTestedNew = true;
                    }
                    changeOccurred = showPhenolphthaleinResult(solutionDiv, solutionType);
                }
            }

            if (changeOccurred) {
                playSound(reactionSound);
            } else if (toolId === 'tool-red-litmus' || toolId === 'tool-blue-litmus' || toolId === 'tool-phenolphthalein') {
                playSound(waterSound);
            }

            if (justTestedNew) {
                updateGuide('check_completion'); 
            } else {
                updateGuide('reaction'); 
            }
        }

        function showLitmusResult(solutionDiv, toolId, solutionType) {
            solutionDiv.innerHTML = '';
            const paper = document.createElement('div');
            paper.className = 'litmus-paper-result';
            let changed = false;

            if (toolId === 'tool-red-litmus') {
                if (solutionType === 'base') {
                    paper.style.backgroundColor = '#6666FF'; 
                    paper.innerText = 'í‘¸ë¥¸ìƒ‰';
                    changed = true;
                } else { 
                    paper.style.backgroundColor = '#FF6666'; 
                    paper.innerText = 'ë³€í™” ì—†ìŒ';
                    changed = false;
                }
            } else if (toolId === 'tool-blue-litmus') {
                if (solutionType === 'acid') {
                    paper.style.backgroundColor = '#FF6666';
                    paper.innerText = 'ë¶‰ì€ìƒ‰';
                    changed = true;
                } else { 
                    paper.style.backgroundColor = '#6666FF';
                    paper.innerText = 'ë³€í™” ì—†ìŒ';
                    changed = false;
                }
            }
            solutionDiv.appendChild(paper);
            return changed; 
        }

        function showPhenolphthaleinResult(solutionDiv, solutionType) {
            solutionDiv.innerHTML = '';
            const alreadyPink = solutionDiv.style.backgroundColor === 'rgb(236, 72, 153)'; 

            if (solutionType === 'base') {
                solutionDiv.style.backgroundColor = '#ec4899';
                return !alreadyPink; 
            } else {
                const solutionIsCyan = solutionDiv.classList.contains('bg-cyan-100');
                solutionDiv.style.backgroundColor = 'transparent';
                
                const noResult = document.createElement('div');
                noResult.className = 'phen-no-result';
                noResult.innerText = 'ë°˜ì‘ ì—†ìŒ';
                solutionDiv.appendChild(noResult);

                if (solutionIsCyan) {
                    // ìœ ë¦¬ ì„¸ì •ì œëŠ” ì›ë˜ ìƒ‰ì´ ìˆì—ˆìœ¼ë¯€ë¡œ 'ë³€í™” ì—†ìŒ'ë„ ë³€í™”ë¡œ ê°„ì£¼
                    return true;
                }
                const alreadyTransparent = solutionDiv.style.backgroundColor === 'transparent' || solutionDiv.style.backgroundColor === '';
                return !alreadyTransparent;
            }
        }

        // --- [4] í€´ì¦ˆ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ë¡œì§ ---

        function handleQuizDragStart(e) {
            if (draggedToolElement) return; 
            draggedQuizLabel = e.target;
            e.dataTransfer.setData('text/plain', draggedQuizLabel.dataset.answer);
            setTimeout(() => draggedQuizLabel.classList.add('dragging'), 0);
        }
        function handleQuizDragEnd(e) {
            if (draggedQuizLabel) draggedQuizLabel.classList.remove('dragging');
            draggedQuizLabel = null;
        }
        function handleQuizTouchStart(e) {
            if (draggedToolElement) return;
            draggedQuizLabel = e.target.closest('.summary-label');
            if (!draggedQuizLabel) return; 
            isTouchDragging = true;
            
            quizGhostElement = draggedQuizLabel.cloneNode(true);
            quizGhostElement.classList.add('ghost-label');
            document.body.appendChild(quizGhostElement);
            updateGhostPosition(e.touches[0], quizGhostElement);
        }
        
        function handleQuizDragOver(e) {
            e.preventDefault();
            const dropZone = e.target.closest('.summary-drop-zone');
            if (draggedQuizLabel && dropZone && !dropZone.classList.contains('filled')) {
                dropZone.classList.add('drag-over');
            }
        }
        function handleQuizDragLeave(e) {
            e.target.closest('.summary-drop-zone')?.classList.remove('drag-over');
        }
        function handleQuizDrop(e) {
            e.preventDefault();
            const dropZone = e.target.closest('.summary-drop-zone');
            if (draggedQuizLabel && dropZone && !dropZone.classList.contains('filled')) {
                runQuizDrop(dropZone, draggedQuizLabel);
            }
        }

        function runQuizDrop(dropZone, label) {
            const answer = label.dataset.answer;
            if (dropZone.dataset.answer === answer) {
                dropZone.innerHTML = (answer === 'acid') ? 'ì‹ì´ˆ, íƒ„ì‚°ìˆ˜,<br>ë¬½ì€ ì—¼ì‚°' : 'ì„íšŒìˆ˜, ìœ ë¦¬ ì„¸ì •ì œ,<br>ë¬½ì€ ìˆ˜ì‚°í™”ë‚˜íŠ¸ë¥¨';
                dropZone.classList.add('filled');
                dropZone.classList.remove('drag-over');
                correctQuizAnswers++;
                checkQuizCompletion();
            } else {
                dropZone.classList.remove('drag-over');
            }
        }
        
        function checkQuizCompletion() {
            if (correctQuizAnswers === 4) {
                updateGuideText("ê²°ê³¼ ì •ë¦¬ ì™„ë£Œ!", "ëª¨ë“  ì •ë‹µì„ ë§í˜”ìŠµë‹ˆë‹¤! ì°¸ ì˜í–ˆì–´ìš”!");
            }
        }

        // --- [5] ì´ˆê¸°í™” ë¡œì§ ---

        // [ë²„ê·¸ ìˆ˜ì •] "í˜„ì¬ ì‹¤í—˜íŒ ë¹„ìš°ê¸°" - ì¹´ìš´í„° ì´ˆê¸°í™” *ì•ˆí•¨*
        function clearCurrentPlate() {
            wells.forEach(well => {
                const solutionDiv = well.querySelector('.solution');
                const solutionName = well.dataset.solution;
                solutionDiv.innerHTML = '';
                solutionDiv.style.backgroundColor = ''; 
                solutionDiv.classList.remove('bg-cyan-100');
                if (solutionName === 'glass-cleaner') {
                    solutionDiv.classList.add('bg-cyan-100');
                }
            });

            if (currentExperiment === 'litmus') {
                // redLitmusUsedCount = 0; // [ìˆ˜ì •] ì¹´ìš´í„° ì´ˆê¸°í™” *ì œê±°*
                // blueLitmusUsedCount = 0; // [ìˆ˜ì •] ì¹´ìš´í„° ì´ˆê¸°í™” *ì œê±°*
                wells.forEach(well => {
                    well.dataset.testedRed = 'false';
                    well.dataset.testedBlue = 'false';
                });
            } else { // phen
                // phenUsedCount = 0; // [ìˆ˜ì •] ì¹´ìš´í„° ì´ˆê¸°í™” *ì œê±°*
                wells.forEach(well => {
                    well.dataset.testedPhen = 'false';
                });
            }
            
            updateGuide('check_completion');
        }

        // "ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°" í•¨ìˆ˜
        function resetExperiment(fullReset = true) {
            if (fullReset) {
                redLitmusUsedCount = 0;
                blueLitmusUsedCount = 0;
                phenUsedCount = 0;
            }

            wells.forEach(well => {
                const solutionDiv = well.querySelector('.solution');
                const solutionName = well.dataset.solution;
                solutionDiv.innerHTML = '';
                solutionDiv.style.backgroundColor = ''; 
                solutionDiv.classList.remove('bg-cyan-100');
                if (solutionName === 'glass-cleaner') {
                    solutionDiv.classList.add('bg-cyan-100');
                }
                
                if (fullReset) {
                    well.dataset.testedRed = 'false';
                    well.dataset.testedBlue = 'false';
                    well.dataset.testedPhen = 'false';
                }
            });

            // í€´ì¦ˆ ì´ˆê¸°í™”
            correctQuizAnswers = 0;
            quizDropZones.forEach(zone => {
                zone.classList.remove('filled');
                zone.innerHTML = 'ì´ê³³ì— ë“œë¡­';
            });
            if (quizGuideText) { 
                 updateGuideText("ì‹¤í—˜ ê²°ê³¼ë¥¼ ë³´ê³ , ì•Œë§ì€ ìš©ì•¡ ë¬¶ìŒì„ ë¹ˆì¹¸ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”!", "");
            }

            if (fullReset) {
                if (currentExperiment !== 'litmus') {
                    switchExperiment('litmus');
                }
                mainTabSummary.disabled = true;
                mainTabSummary.classList.remove('pulsing-guide');
                showMainTab('experiment');
                updateGuide('init'); 
            }
        }

        // --- [6] ì´ˆê¸° ë¡œë“œ (DOMContentLoaded) ---
        document.addEventListener('DOMContentLoaded', () => {
            // ë³€ìˆ˜ í• ë‹¹ (ì‹¤í—˜)
            waterSound = document.getElementById('water-sound');
            reactionSound = document.getElementById('reaction-sound');
            toolsArea = document.getElementById('tools-area');
            tools = document.querySelectorAll('.tool'); 

            mainTabExperiment = document.getElementById('main-tab-experiment');
            mainTabSummary = document.getElementById('main-tab-summary');
            experimentContent = document.getElementById('experiment-content');
            summaryContent = document.getElementById('summary-content');

            expTabLitmus = document.getElementById('exp-tab-litmus');
            expTabPhen = document.getElementById('exp-tab-phen');
            
            toolItemRedLitmus = document.getElementById('tool-item-red-litmus');
            toolItemBlueLitmus = document.getElementById('tool-item-blue-litmus');
            toolItemPhen = document.getElementById('tool-item-phen');
            
            mainPlate = document.getElementById('litmus-plate');
            guideTextBox = document.getElementById('guide-text-box');
            plateTitle = document.getElementById('plate-title');
            clearPlateButton = document.getElementById('clear-plate-button'); 
            wells = document.querySelectorAll('.well-plate .well'); 
            resetButton = document.getElementById('reset-button');

            // ë³€ìˆ˜ í• ë‹¹ (í€´ì¦ˆ)
            quizLabels = document.querySelectorAll('.summary-label');
            quizDropZones = document.querySelectorAll('.summary-drop-zone');
            quizLabelPool = document.getElementById('quiz-label-pool');
            quizGuideText = document.getElementById('quiz-guide-text');

            
            // --- ì‹¤í—˜ ë„êµ¬ D&D (ë°ìŠ¤í¬íƒ‘) ---
            tools.forEach(tool => {
                tool.addEventListener('dragstart', (e) => {
                    if (draggedQuizLabel) return;
                    const parentTool = e.target.closest('.tool');
                    if (parentTool && parentTool.id) {
                        draggedToolId = parentTool.id;
                        draggedToolElement = parentTool;
                        parentTool.classList.add('dragging');
                        e.dataTransfer.setData('text/plain', draggedToolId);
                    } else {
                        e.preventDefault(); 
                    }
                });
                tool.addEventListener('dragend', (e) => {
                    if (draggedToolElement) draggedToolElement.classList.remove('dragging');
                    draggedToolId = null;
                    draggedToolElement = null;
                });
            });

            // --- í€´ì¦ˆ ë¼ë²¨ D&D (ë°ìŠ¤í¬íƒ‘) ---
            quizLabels.forEach(label => {
                label.addEventListener('dragstart', handleQuizDragStart);
                label.addEventListener('dragend', handleQuizDragEnd);
            });
            quizDropZones.forEach(zone => {
                zone.addEventListener('dragover', handleQuizDragOver);
                zone.addEventListener('dragleave', handleQuizDragLeave);
                zone.addEventListener('drop', handleQuizDrop);
            });


            // --- ê³µí†µ í„°ì¹˜ D&D (ëª¨ë°”ì¼) ---
            document.addEventListener('touchstart', (e) => {
                const tool = e.target.closest('.tool');
                const label = e.target.closest('.summary-label');
                
                if (tool) {
                    if (draggedQuizLabel) return;
                    draggedToolElement = tool;
                    draggedToolId = tool.id;
                    isTouchDragging = true;
                    ghostElement = draggedToolElement.cloneNode(true);
                    ghostElement.classList.add('ghost-tool');
                    document.body.appendChild(ghostElement);
                    updateGhostPosition(e.touches[0], ghostElement);
                } else if (label) {
                    if (draggedToolElement) return;
                    draggedQuizLabel = label;
                    isTouchDragging = true;
                    quizGhostElement = draggedQuizLabel.cloneNode(true);
                    quizGhostElement.classList.add('ghost-label');
                    document.body.appendChild(quizGhostElement);
                    updateGhostPosition(e.touches[0], quizGhostElement);
                }
            }, { passive: false });
    
            document.addEventListener('touchmove', (e) => {
                if (!isTouchDragging) return;
                e.preventDefault();
                const touch = e.touches[0];
                const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

                if (draggedToolElement) {
                    updateGhostPosition(touch, ghostElement);
                    const dropTarget = elementUnderTouch?.closest('.well');
                    if(dropTarget) dropTarget.classList.add('drag-over'); 
                } else if (draggedQuizLabel) {
                    updateGhostPosition(touch, quizGhostElement);
                    const dropTarget = elementUnderTouch?.closest('.summary-drop-zone');
                    if(dropTarget && !dropTarget.classList.contains('filled')) {
                        dropTarget.classList.add('drag-over');
                    }
                }
            }, { passive: false });
    
            document.addEventListener('touchend', (e) => {
                if (!isTouchDragging) return;
                isTouchDragging = false;
                const touch = e.changedTouches[0];
                // touchend ì´ë²¤íŠ¸ì—ì„œëŠ” elementFromPointê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ,
                // touchmoveì—ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì—…ë°ì´íŠ¸ëœ ìœ„ì¹˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš”ì†Œë¥¼ ì°¾ì•„ì•¼ í•  ìˆ˜ ìˆì§€ë§Œ,
                // ì—¬ê¸°ì„œëŠ” ê°„ê²°ì„±ì„ ìœ„í•´ ë§ˆì§€ë§‰ í„°ì¹˜ í¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                if (draggedToolElement) {
                    const dropTarget = elementUnderTouch?.closest('.well');
					if (dropTarget) {
                        runExperiment(dropTarget, draggedToolId);
                    }
                    if (ghostElement) document.body.removeChild(ghostElement);
                    ghostElement = null;
                    draggedToolElement = null;
                    draggedToolId = null;
                } else if (draggedQuizLabel) {
                    const dropTarget = elementUnderTouch?.closest('.summary-drop-zone');
                    if (dropTarget && !dropTarget.classList.contains('filled')) {
                        runQuizDrop(dropTarget, draggedQuizLabel);
                    }
                    if (quizGhostElement) document.body.removeChild(quizGhostElement);
                    quizGhostElement = null;
                    draggedQuizLabel = null;
                }
            });
    
            function updateGhostPosition(touch, ghostEl) {
                if (!ghostEl) return;
                ghostEl.style.left = `${touch.clientX}px`;
                ghostEl.style.top = `${touch.clientY}px`;
            }

            // í™ˆíŒ ë“œë¡­ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬íƒ‘ ì „ìš©)
            wells.forEach(well => {
                well.addEventListener('dragover', (e) => {
                    e.preventDefault();
                });
                well.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const toolId = e.dataTransfer.getData('text/plain');
                    if (toolId) { 
                        runExperiment(e.target, toolId);
                    }
                });
            });

            // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            mainTabExperiment.addEventListener('click', () => showMainTab('experiment'));
            mainTabSummary.addEventListener('click', () => showMainTab('summary'));
            expTabLitmus.addEventListener('click', () => switchExperiment('litmus'));
            expTabPhen.addEventListener('click', () => switchExperiment('phen'));
            clearPlateButton.addEventListener('click', clearCurrentPlate);
            resetButton.addEventListener('click', () => resetExperiment(true));

            // ì•± ì‹œì‘
            resetExperiment(true); 
        });
    </script>
</body>
</html>
