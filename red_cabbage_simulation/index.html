<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½ ì‹¤í—˜</title>
    
    <!-- êµ¬ê¸€ í°íŠ¸ 'Jua' ë¡œë“œ --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 'Jua' í°íŠ¸ ê¸°ë³¸ ì ìš© */
        body {
            font-family: 'Jua', sans-serif;
            background-color: #f0f4f8; 
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 25px;
            display: flex; 
            flex-direction: column;
            align-items: center;
        }

        /* 'ë¦¬íŠ¸ë¨¸ìŠ¤' ì•±ì˜ ì œëª© ìŠ¤íƒ€ì¼ */
        .main-title {
            text-align: center;
            font-size: 3.5rem; 
            font-weight: bold;
            color: #6666FF; 
            text-shadow: 
                -2px -2px 0 #fff,  
                 2px -2px 0 #fff,
                -2px  2px 0 #fff,
                 2px  2px 0 #fff,
                 4px 4px 0 rgba(0,0,0,0.3); 
            line-height: 1.2; 
            padding-bottom: 10px;
            margin-bottom: 20px; 
        }

        /* h2 ìŠ¤íƒ€ì¼ ì •ì˜ */
        h2 {
            color: #111;
            font-size: 1.8em; 
            font-weight: bold; 
            margin-bottom: 15px; 
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.2;
            min-width: 280px; 
        }
        
        h2::before {
            margin-right: 8px;
            font-size: 1.2em;
        }
        
        /* h3 (ê²°ê³¼ ë°•ìŠ¤ ë‚´) ìŠ¤íƒ€ì¼ ì •ì˜ */
        h3 {
             color: #111;
             font-size: 1.4rem;
         }


        /* ì‹¤í—˜ ì˜ì—­ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ë˜í¼ */
        .experiment-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center; 
            width: 100%; 
            max-width: 721px; 
        }


        /* ì „ì²´ ë ˆì´ì•„ì›ƒ (ê°„ê²© ë¬¸ì œ í•´ê²°) */
        .lab-bench {
            display: flex;
            flex-direction: column; 
            gap: 20px; /* ëª¨ë°”ì¼ ì„¸ë¡œ ê°„ê²© */
            margin-top: 0; 
            align-items: center; 
            width: 100%;
        }

        @media (min-width: 768px) {
            .lab-bench {
                flex-direction: row; 
                align-items: flex-start; 
                gap: 25px; 
                width: auto; 
            }
        }

        /* ì™¼ìª½ ì „ì²´ ì˜ì—­ (ì œëª©ê³¼ ë°•ìŠ¤ ëª¨ë‘ í¬í•¨) */
        .left-content-wrapper {
            flex-shrink: 0; 
            display: flex;
            flex-direction: column;
            align-items: center; 
            width: 320px; 
            box-sizing: border-box;
        }
        
        /* 'ì‚¬ìš© ë°©ë²•' ì œëª© ìŠ¤íƒ€ì¼ */
        .left-content-wrapper h2::before {
            content: 'âœ¨'; 
        }

        /* ì—°ë³´ë¼ìƒ‰ ì ì„  í…Œë‘ë¦¬ ë°•ìŠ¤ (ë‚´ìš©ë¬¼ë§Œ í¬í•¨) */
        .instructions-box {
            border: 2px dashed #C8B6E2;
            background-color: #fafaff; 
            padding: 15px; 
            border-radius: 10px;
            width: 100%; 
            display: flex;
            flex-direction: column;
            gap: 5px; 
            align-items: center;
            height: 298px; 
            box-sizing: border-box; 
        }
        
        /* 'ì‚¬ìš© ë°©ë²•' ì„¤ëª… í…ìŠ¤íŠ¸ */
        .instructions-box p {
            text-align: center;
            font-size: 1.1rem;
            color: #333;
            width: 100%; 
            padding-left: 0px; 
            line-height: 1.4;
            margin-bottom: 5px; 
        }
        
        /* ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½ ë„êµ¬ ì˜ì—­ */
        .tool-item {
            display: flex;
            flex-direction: column;
            align-items: center; 
            text-align: center;
            font-size: 1rem;
            color: #333;
            width: 100%; 
            margin-top: 5px; 
            margin-bottom: 5px; 
        }
         .tool-item p {
             margin-top: 8px; 
             line-height: 1.2;
             text-align: center; 
         }

        /* ë“œë˜ê·¸ ê°€ëŠ¥í•œ ë„êµ¬ ìŠ¤íƒ€ì¼ (í¬ê¸° ì¡°ì •) */
        .tool {
            width: 80px; 
            height: 80px; 
            border: 1px solid #c0c0c0; 
            background-color: #f0f0f0;
            cursor: grab;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center; 
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }
        .tool.dragging {
            cursor: grabbing;
            opacity: 0.5;
            transform: scale(1.1);
        }
        
        /* [ìˆ˜ì •] SVG -> img ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
        .tool img {
            width: 64px; 
            height: 64px; 
            object-fit: contain;
        }

        /* í„°ì¹˜ ë“œë˜ê·¸ ì‹œ ë³µì œë˜ëŠ” ìœ ë ¹ ìš”ì†Œ (ì§€ì‹œì•½ìš©) */
        .ghost-tool {
            position: absolute;
            pointer-events: none;
            opacity: 0.7;
            z-index: 1000;
            transform: translate(-50%, -50%); 
            width: 80px; 
            height: 80px; 
            border: 1px solid #c0c0c0; 
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center; 
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* [ìˆ˜ì •] SVG -> img ì•„ì´ì½˜ í¬ê¸° ì¡°ì • */
        .ghost-tool img {
            width: 64px;
            height: 64px;
            object-fit: contain;
        }

        /* ì‹¤í—˜ ì§„í–‰ ì˜ì—­ (ì˜¤ë¥¸ìª½) */
        .experiment-area {
            flex-grow: 1; 
            display: flex;
            flex-direction: column;
            align-items: center; 
            gap: 0; 
            box-sizing: border-box;
        }

        /* ë¦¬ì…‹ ë²„íŠ¼ ìœ„ì¹˜ ì¡°ì • */
        #reset-button {
            background-color: #ef4444; 
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: auto; 
            align-self: center; 
            width: 200px; 
            max-width: 80%; 
        }
        #reset-button:hover {
            background-color: #dc2626; 
        }

        /* 6í™ˆíŒ ìŠ¤íƒ€ì¼ */
        .well-plate {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            grid-template-rows: repeat(2, 1fr); 
            gap: 8px; 
            background-color: #ffffff;
            border: 1px solid #e0e0e0; 
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
            width: fit-content; 
            margin: 0 auto; 
            height: 298px; 
            box-sizing: border-box; 
        }

        /* ê° í™ˆ(well) ì»¨í…Œì´ë„ˆ (ë“œë¡­ íƒ€ê²Ÿ) */
        .well {
            position: relative; 
            width: 110px; 
            height: 130px; 
            border: 1px solid #eee; 
            border-radius: 8px;
            background-color: #f9f9f9; 
            display: flex;
            flex-direction: column; 
            align-items: center;
            padding: 8px 5px 5px 5px; 
            box-sizing: border-box; 
            transition: all 0.2s; /* ë°˜ì§ì„ íš¨ê³¼ë¥¼ ìœ„í•´ ì¶”ê°€ */
        }

        /* ìš©ì•¡ ì› */
        .well .solution {
            width: 70px; 
            height: 70px; 
            margin: 0 auto; 
            border: 1px solid #d0d0d0; 
            border-radius: 50%;
            background-color: #f0f8ff; 
            transition: background-color 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            position: relative; 
            box-shadow: 0 0 5px rgba(0,0,0,0.05) inset;
            flex-shrink: 0; 
        }
        
        /* ë¼ë²¨ */
        .well .label {
            position: static; 
            width: 100%; 
            font-size: 0.9em; 
            font-weight: bold;
            color: #555;
            text-align: center; 
            line-height: 1.2;
            padding: 0 2px;
            box-sizing: border-box;
            flex-grow: 1; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        /* ì§€ì‹œì•½ì´ ë–¨ì–´ì§„ ìƒíƒœ (ìƒ‰ìƒ ë³€í•¨) */
        .solution[data-colored="true"] {
             background-color: var(--solution-color);
         }

        /* ì‹¤í—˜ ì„¸íŠ¸ ì œëª© */
         .experiment-set {
             display: flex; 
             flex-direction: column;
             align-items: center;
             width: 100%; 
         }
        
         .experiment-set h2::before {
             content: 'ğŸ§ª'; 
         }

        /* ê²°ê³¼ ì˜ì—­ */
        #results-area {
            display: none; 
            margin-top: 25px;
            padding: 20px;
            border-top: 2px dashed #007bff;
            background: #f7fbff;
            width: 100%; 
            box-sizing: border-box;
        }
        #results-area.show {
            display: block; 
        }

        .result-box {
            display: flex;
            flex-direction: column; 
            gap: 20px;
        }

        @media (min-width: 640px) {
            .result-box {
                flex-direction: row; 
                justify-content: space-between;
            }
        }
        
        /* ë“œë¡­ ì¡´ ìŠ¤íƒ€ì¼ í™•ì¥ */
        .result-group {
            flex-basis: 48%; 
            padding: 15px;
            border-radius: 8px;
            transition: background-color 0.2s; 
        }
        .result-group.acid {
            background-color: #fff0f0;
            border: 1px solid #e53935;
        }
        .result-group.base {
            background-color: #f0fff4;
            border: 1px solid #4caf50;
        }
        /* ë“œë˜ê·¸ ì˜¬ë ¸ì„ ë•Œ í”¼ë“œë°± (ë°•ìŠ¤ ì „ì²´) */
        .result-group.drag-over {
            background-color: #e0e0e0;
        }
        .result-group h3 {
            margin-top: 0;
            font-size: 1.4rem;
            pointer-events: none; /* ë“œë¡­ ì´ë²¤íŠ¸ê°€ ë°•ìŠ¤ë¡œ ì „ë‹¬ë˜ë„ë¡ */
        }
        
        /* ë“œë¡­ ì¡´ ìŠ¤íƒ€ì¼ */
        .result-group ul {
            padding-left: 0;
            list-style-type: none;
            margin-top: 10px;
            min-height: 100px; /* ë“œë¡­í•  ìˆ˜ ìˆëŠ” ìµœì†Œ ë†’ì´ */
            border: 2px dashed #ccc;
            border-radius: 5px;
            padding: 10px;
            pointer-events: none; /* ë“œë¡­ ì´ë²¤íŠ¸ê°€ ë°•ìŠ¤ë¡œ ì „ë‹¬ë˜ë„ë¡ */
        }
        
        /* ë“œë¡­ëœ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .result-group ul li {
            background-color: white;
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 5px;
            font-size: 1.1rem;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            pointer-events: none; /* ë“œë¡­ ì´ë²¤íŠ¸ê°€ ë°•ìŠ¤ë¡œ ì „ë‹¬ë˜ë„ë¡ */
        }

        /* ë¶„ë¥˜í•  ìš©ì•¡ (ì´ë¦„í‘œ) ì„¹ì…˜ */
        #label-pool-container {
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            margin-top: 20px;
            width: 100%;
        }
        #label-pool-container h3 {
            font-size: 1.4rem;
            text-align: center;
            margin-bottom: 15px;
        }
        .label-pool {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #eee;
        }
        
        /* ë“œë˜ê·¸í•  ì´ë¦„í‘œ ìŠ¤íƒ€ì¼ */
        .solution-label {
            padding: 10px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            cursor: grab;
            font-size: 1.1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        
        /* ë“œë˜ê·¸ ì¤‘ì¸ ì´ë¦„í‘œ ìŠ¤íƒ€ì¼ */
        .solution-label.dragging {
            opacity: 0.5;
            cursor: grabbing;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* í„°ì¹˜ ë“œë˜ê·¸ ì‹œ ë³µì œë˜ëŠ” ìœ ë ¹ ìš”ì†Œ (ì´ë¦„í‘œìš©) */
        .ghost-label {
            position: absolute;
            pointer-events: none;
            opacity: 0.8;
            z-index: 1000;
            transform: translate(-50%, -50%);
            padding: 10px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 1.1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        /* ë¶„ë¥˜ ì™„ë£Œ ì‹œ ìˆ¨ê¸°ê¸° (JavaScriptë¡œ ì œì–´) */
        .solution-label.classified {
            display: none;
        }


        /* 'ì•Œê²Œ ëœ ì ' ë°•ìŠ¤ (ì´ˆê¸° ìˆ¨ê¹€) */
        #knowledge-point {
            display: none; 
            margin-top: 20px;
        }
        #knowledge-point.show {
            display: block;
        }

        /* [NEW] ì°¸ê³  ì½”ë“œì—ì„œ ê°€ì ¸ì˜¨ ë°˜ì§ì„ íš¨ê³¼ */
        @keyframes pulse-guide {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.9); } 
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }
        /* [NEW] ë°˜ì§ì„ í´ë˜ìŠ¤ (box-shadow ì‚¬ìš©) */
        .pulsing-guide {
            animation: pulse-guide 1.5s infinite;
            border-radius: 8px; /* tool, label ëª¨ì–‘ì— ë§ì¶° ì ìš© */
        }
        .solution-label.pulsing-guide {
            border-radius: 20px; /* ì´ë¦„í‘œ ëª¨ì–‘ì— ë§ì¶¤ */
        }
        
    </style>
</head>
<body class="bg-gray-100">

    <div class="container my-5">
        <h1 class="main-title">
            ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½ ì‹¤í—˜
        </h1>
        
        <div class="experiment-wrapper">
            <div class="lab-bench">
                
                <!-- ì™¼ìª½ ì˜ì—­ -->
                <div class="left-content-wrapper">
                    <h2 class="text-3xl font-bold mb-4">ì‚¬ìš© ë°©ë²•</h2>
                    <div class="instructions-box">
                        <p>
                            - ì•„ë˜ì˜ 'ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½'ì„ ëŒì–´ <br>6í™ˆíŒì— ë†“ì•„ ë³´ì„¸ìš”.
                        </p>
                        
                        <!-- [ìˆ˜ì •] ì§€ì‹œì•½ ë„êµ¬ -->
                        <div class="tool-item">
                            <!-- [ìˆ˜ì •] SVGë¥¼ IMG íƒœê·¸ë¡œ ë³€ê²½ -->
                            <div class="tool" id="tool-cabbage-indicator" draggable="true">
                                <img src="indicator-dropper.png" alt="ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½">
                            </div>
                            <p>ë¶‰ì€ ì–‘ë°°ì¶”<br>ì§€ì‹œì•½</p>
                        </div>
                        
                        <button id="reset-button">ì²˜ìŒë¶€í„° ë‹¤ì‹œí•˜ê¸°</button> 
                    </div>
                </div>

                <!-- ì˜¤ë¥¸ìª½ ì˜ì—­ -->
                <div class="experiment-area">
                    <div class="experiment-set">
                        <h2 class="text-3xl font-bold mb-4">ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½ ì‹¤í—˜</h2>
                        <div class="well-plate" id="cabbage-plate">
                            <!-- 6í™ˆíŒ ë‚´ìš© -->
                            <div class="well" data-solution="vinegar" data-type="acid">
                                <div class="solution"></div>
                                <div class="label">ì‹ì´ˆ</div>
                            </div>
                            <div class="well" data-solution="carbonated" data-type="acid">
                                <div class="solution"></div>
                                <div class="label">íƒ„ì‚°ìˆ˜</div>
                            </div>
                            <div class="well" data-solution="limewater" data-type="base">
                                <div class="solution"></div>
                                <div class="label">ì„íšŒìˆ˜</div>
                            </div>
                            <div class="well" data-solution="hcl" data-type="acid">
                                <div class="solution"></div>
                                <div class="label">ë¬½ì€ ì—¼ì‚°</div>
                            </div>
                            <div class="well" data-solution="cleaner" data-type="base">
                                <div class="solution"></div>
                                <div class="label">ìœ ë¦¬ ì„¸ì •ì œ</div>
                            </div>
                            <div class="well" data-solution="naoh" data-type="base">
                                <div class="solution"></div>
                                <div class="label">ë¬½ì€ ìˆ˜ì‚°í™”<br>ë‚˜íŠ¸ë¥¨ ìš©ì•¡</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê²°ê³¼ ë¶„ë¥˜ ì˜ì—­ (ì´ˆê¸° ìˆ¨ê¹€) -->
            <div id="results-area">
                <h2 class="text-3xl font-bold mb-4">ğŸ”¬ ì‹¤í—˜ ê²°ê³¼ ë¶„ë¥˜</h2>
                <div class="result-box">
                    <div class="result-group acid" data-zone="acid">
                        <h3 class="font-semibold mb-2">ë¶‰ì€ìƒ‰ ê³„ì—´ (ì‚°ì„± ìš©ì•¡)</h3>
                        <ul id="acid-list"></ul>
                    </div>
                    <div class="result-group base" data-zone="base">
                        <h3 class="font-semibold mb-2">í‘¸ë¥¸/ë…¹/ë…¸ë€ìƒ‰ ê³„ì—´ (ì—¼ê¸°ì„± ìš©ì•¡)</h3>
                        <ul id="base-list"></ul>
                    </div>
                </div>

                <!-- ì´ë¦„í‘œ í’€ (ì´ˆê¸° ìˆ¨ê¹€) -->
                <div id="label-pool-container">
                    <h3 class="font-semibold mb-3 text-center">ğŸ‘‡ ì•„ë˜ì˜ ì´ë¦„í‘œë¥¼ ëŒì–´ ë¶„ë¥˜í•´ ë³´ì„¸ìš”.</h3>
                    <div class="label-pool">
                        <div class="solution-label" id="label-vinegar" draggable="true" data-type="acid">ì‹ì´ˆ</div>
                        <div class="solution-label" id="label-carbonated" draggable="true" data-type="acid">íƒ„ì‚°ìˆ˜</div>
                        <div class="solution-label" id="label-limewater" draggable="true" data-type="base">ì„íšŒìˆ˜</div>
                        <div class="solution-label" id="label-hcl" draggable="true" data-type="acid">ë¬½ì€ ì—¼ì‚°</div>
                        <div class="solution-label" id="label-cleaner" draggable="true" data-type="base">ìœ ë¦¬ ì„¸ì •ì œ</div>
                        <div class="solution-label" id="label-naoh" draggable="true" data-type="base">ë¬½ì€ ìˆ˜ì‚°í™” ë‚˜íŠ¸ë¥¨</div>
                    </div>
                </div>
                
                <!-- ì•Œê²Œ ëœ ì  (ì´ˆê¸° ìˆ¨ê¹€) -->
                <p id="knowledge-point" class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md">
                    <b>ì•Œê²Œ ëœ ì :</b> ë¶‰ì€ ì–‘ë°°ì¶” ì§€ì‹œì•½ì€ ì‚°ì„± ìš©ì•¡ì„ ë§Œë‚˜ë©´ ë¶‰ì€ìƒ‰ ê³„ì—´ë¡œ, ì—¼ê¸°ì„± ìš©ì•¡ì„ ë§Œë‚˜ë©´ í‘¸ë¥¸ìƒ‰, ë…¹ìƒ‰, ë…¸ë€ìƒ‰ ê³„ì—´ë¡œ ë³€í•©ë‹ˆë‹¤.
                    ì´ ê²°ê³¼ëŠ” ë¦¬íŠ¸ë¨¸ìŠ¤ ì¢…ì´ë‚˜ í˜ë†€í”„íƒˆë ˆì¸ ìš©ì•¡ìœ¼ë¡œ ë¶„ë¥˜í•œ ê²°ê³¼ì™€ ì¼ì¹˜í•©ë‹ˆë‹¤.
                </p>
            </div>
        </div> 

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // [NEW] íš¨ê³¼ìŒ í”Œë ˆì´ì–´ ë³€ìˆ˜
            let waterSoundEffect;

            // [NEW] íš¨ê³¼ìŒ ë¡œë“œ (ì°¸ê³  ì½”ë“œ)
            try {
                // water.mp3 íŒŒì¼ì´ index.htmlê³¼ ê°™ì€ ìœ„ì¹˜ì— ìˆë‹¤ê³  ê°€ì •
                waterSoundEffect = new Audio('water.mp3');
                waterSoundEffect.load(); 
            } catch (e) {
                console.error("Audio íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", e);
                waterSoundEffect = null;
            }

            // [NEW] íš¨ê³¼ìŒ ì¬ìƒ í•¨ìˆ˜ (ì°¸ê³  ì½”ë“œ)
            function playDropSound() {
                if (!waterSoundEffect) return;
                waterSoundEffect.currentTime = 0;
                waterSoundEffect.volume = 0.5; // ë³¼ë¥¨ ì¡°ì ˆ
                waterSoundEffect.play().catch(e => console.error("íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:", e));
            }

            // ìš©ì•¡ ì •ë³´
            const solutions = {
                'vinegar': { name: 'ì‹ì´ˆ', color: '#F06292', type: 'acid' }, // ë¶„í™ìƒ‰
                'carbonated': { name: 'íƒ„ì‚°ìˆ˜', color: '#CE93D8', type: 'acid' }, // ì—°ë³´ë¼ìƒ‰
                'hcl': { name: 'ë¬½ì€ ì—¼ì‚°', color: '#E53935', type: 'acid' }, // ë¶‰ì€ìƒ‰
                'limewater': { name: 'ì„íšŒìˆ˜', color: '#DCE775', type: 'base' }, // ì—°ë‘ìƒ‰
                'cleaner': { name: 'ìœ ë¦¬ ì„¸ì •ì œ', color: '#4CAF50', type: 'base' }, // ë…¹ìƒ‰
                'naoh': { name: 'ë¬½ì€ ìˆ˜ì‚°í™” ë‚˜íŠ¸ë¥¨', color: '#FFEE58', type: 'base' } // ë…¸ë€ìƒ‰
            };

            // === 1. ì§€ì‹œì•½ ë“œë˜ê·¸ ê´€ë ¨ ìš”ì†Œ ===
            const indicatorTool = document.getElementById('tool-cabbage-indicator'); // [NEW] ì§€ì‹œì•½ ë„êµ¬
            const wells = document.querySelectorAll('.well');
            let indicatorColoredCount = 0;

            // === 2. ì´ë¦„í‘œ ë¶„ë¥˜ ë“œë˜ê·¸ ê´€ë ¨ ìš”ì†Œ ===
            const solutionLabels = document.querySelectorAll('.solution-label');
            const dropZones = document.querySelectorAll('.result-group');
            const resultsArea = document.getElementById('results-area');
            const labelPoolContainer = document.getElementById('label-pool-container');
            const knowledgePoint = document.getElementById('knowledge-point');
            const acidList = document.getElementById('acid-list'); 
            const baseList = document.getElementById('base-list'); 
            let classifiedCount = 0;
            
            // === 3. ê³µí†µ ìš”ì†Œ ===
            const resetButton = document.getElementById('reset-button');
            
            // --- ê³µí†µ ë“œë˜ê·¸ ë³€ìˆ˜ ---
            let draggedElement = null;
            let draggedType = null;
            let isTouchDragging = false;
            let ghostElement = null;


            // [NEW] ë°˜ì§ì„ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì ìš©í•˜ëŠ” í•¨ìˆ˜
            function checkPulseState() {
                // 1. ì§€ì‹œì•½ ë°˜ì§ì„ ì œì–´
                // 6ê°œê°€ ë‹¤ ì°¨ì§€ ì•Šì•˜ìœ¼ë©´ ì§€ì‹œì•½ ë°˜ì§ì„
                if (indicatorColoredCount < wells.length) {
                    indicatorTool.classList.add('pulsing-guide');
                } else {
                    indicatorTool.classList.remove('pulsing-guide');
                }

                // 2. ì´ë¦„í‘œ ë°˜ì§ì„ ì œì–´ (ë¶„ë¥˜ ì˜ì—­ì´ ë³´ì¼ ë•Œë§Œ)
                if (resultsArea.classList.contains('show') && classifiedCount < solutionLabels.length) {
                    solutionLabels.forEach(label => {
                        // ë¶„ë¥˜ë˜ì§€ ì•Šì€(ìˆ¨ê²¨ì§€ì§€ ì•Šì€) ì´ë¦„í‘œë§Œ ë°˜ì§ì„
                        if (!label.classList.contains('classified')) {
                            label.classList.add('pulsing-guide');
                        } else {
                            label.classList.remove('pulsing-guide');
                        }
                    });
                } else {
                    // ë¶„ë¥˜ ì˜ì—­ì´ ì•ˆë³´ì´ê±°ë‚˜, ë‹¤ ë¶„ë¥˜í–ˆìœ¼ë©´ ë°˜ì§ì„ ëª¨ë‘ ì œê±°
                    solutionLabels.forEach(label => label.classList.remove('pulsing-guide'));
                }
            }


            // ===========================================
            // === 1. ì§€ì‹œì•½ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ===
            // ===========================================

            // 1-1. ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ (ì§€ì‹œì•½)
            indicatorTool.addEventListener('dragstart', (e) => {
                const target = e.target.closest('.tool');
                if (!target) return;
                
                draggedElement = target;
                draggedType = 'indicator'; // íƒ€ì… êµ¬ë¶„
                target.classList.add('dragging');
                target.classList.remove('pulsing-guide'); // [NEW] ë“œë˜ê·¸ ì‹œì‘ ì‹œ ë°˜ì§ì„ ì œê±°
                e.dataTransfer.setDragImage(new Image(), 0, 0); 
                e.dataTransfer.setData('text/plain', target.id);
            });

            indicatorTool.addEventListener('dragend', (e) => {
                if (draggedElement) draggedElement.classList.remove('dragging');
                draggedElement = null;
                draggedType = null;
                checkPulseState(); // [NEW] ë“œë˜ê·¸ ì¢…ë£Œ ì‹œ ë°˜ì§ì„ ìƒíƒœ ì¬í™•ì¸
            });

            // 1-2. í„°ì¹˜ ë“œë˜ê·¸ (ì§€ì‹œì•½)
            indicatorTool.addEventListener('touchstart', (e) => {
                const target = e.target.closest('.tool');
                if (!target) return;
                
                draggedElement = target;
                draggedType = 'indicator';
                isTouchDragging = true;
                target.classList.remove('pulsing-guide'); // [NEW] í„°ì¹˜ ì‹œì‘ ì‹œ ë°˜ì§ì„ ì œê±°
                
                ghostElement = target.cloneNode(true);
                ghostElement.classList.add('ghost-tool');
                
                // [ìˆ˜ì •] SVGê°€ ì•„ë‹Œ IMGë¥¼ ë³µì œí•˜ë„ë¡ ë³€ê²½
                const originalImg = target.querySelector('img');
                if (originalImg) {
                    ghostElement.innerHTML = originalImg.outerHTML;
                } else {
                    ghostElement.innerHTML = ''; // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë¹ˆì¹¸
                }
                
                document.body.appendChild(ghostElement);
                
                updateGhostPosition(e.touches[0], ghostElement);
            }, { passive: false });


            // 1-3. ì§€ì‹œì•½ ë“œë¡­ ì‹¤í–‰ (ê³µí†µ ë¡œì§)
            function runIndicatorDrop(targetElement) {
                const targetWell = targetElement.closest('.well');
                if (!targetWell) return; 

                const solutionDiv = targetWell.querySelector('.solution');
                if (!solutionDiv || solutionDiv.dataset.colored) return; // ì´ë¯¸ ìƒ‰ì¹ ëìœ¼ë©´ ë¬´ì‹œ

                const solutionId = targetWell.dataset.solution;
                const solutionData = solutions[solutionId];

                if (solutionData) {
                    solutionDiv.style.setProperty('--solution-color', solutionData.color);
                    solutionDiv.dataset.colored = 'true'; 
                    indicatorColoredCount++;
                    playDropSound(); // [NEW] íš¨ê³¼ìŒ ì¬ìƒ
                }

                // [NEW] 6ê°œê°€ ëª¨ë‘ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (indicatorColoredCount === wells.length) {
                    showClassificationArea(); 
                    // [NEW] 6ê°œ ì™„ë£Œ ì‹œ ì§€ì‹œì•½ ë°˜ì§ì„ ì œê±°
                    indicatorTool.classList.remove('pulsing-guide'); 
                }
            }
            
            // =================================================
            // === 2. ì´ë¦„í‘œ ë¶„ë¥˜ ë“œë˜ê·¸ ì•¤ ë“œë¡­ ===
            // =================================================

            // 2-1. ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ (ì´ë¦„í‘œ)
            solutionLabels.forEach(label => {
                label.addEventListener('dragstart', (e) => {
                    draggedElement = e.target;
                    draggedType = 'label'; // íƒ€ì… êµ¬ë¶„
                    e.target.classList.add('dragging');
                    e.target.classList.remove('pulsing-guide'); // [NEW] ë“œë˜ê·¸ ì‹œì‘ ì‹œ ë°˜ì§ì„ ì œê±°
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.dataTransfer.setData('data-type', e.target.dataset.type);
                });

                label.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                    draggedElement = null;
                    draggedType = null;
                    // ë“œë˜ê·¸ê°€ ì‹¤íŒ¨(ì˜ëª»ëœ ê³³ì— ë“œë¡­)í–ˆì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ë°˜ì§ì„ ì¬í™•ì¸
                    checkPulseState(); 
                });
            });
            
            // 2-2. í„°ì¹˜ ë“œë˜ê·¸ (ì´ë¦„í‘œ)
            solutionLabels.forEach(label => {
                label.addEventListener('touchstart', (e) => {
                    e.stopPropagation(); // ì§€ì‹œì•½ í„°ì¹˜ì™€ êµ¬ë¶„
                    draggedElement = e.target.closest('.solution-label');
                    if (!draggedElement) return;

                    draggedType = 'label';
                    isTouchDragging = true;
                    draggedElement.classList.remove('pulsing-guide'); // [NEW] í„°ì¹˜ ì‹œì‘ ì‹œ ë°˜ì§ì„ ì œê±°

                    ghostElement = draggedElement.cloneNode(true);
                    ghostElement.classList.add('ghost-label');
                    document.body.appendChild(ghostElement);
                    
                    updateGhostPosition(e.touches[0], ghostElement);
                }, { passive: false });
            });


            // 2-3. ì´ë¦„í‘œ ë“œë¡­ ì‹¤í–‰ (ê³µí†µ ë¡œì§)
            function runClassificationDrop(dropGroup, draggedEl) {
                if (!draggedEl) return;
                
                const draggedDataType = draggedEl.dataset.type;
                const dropZoneType = dropGroup.dataset.zone;
                const listElement = dropGroup.querySelector('ul');

                // [ì •ë‹µ/ì˜¤ë‹µ í™•ì¸]
                if (draggedDataType === dropZoneType) {
                    // ì •ë‹µ
                    const li = document.createElement('li');
                    li.textContent = draggedEl.textContent;
                    listElement.appendChild(li); 
                    
                    draggedEl.style.display = 'none'; // ì›ë³¸ ì´ë¦„í‘œ ìˆ¨ê¸°ê¸°
                    draggedEl.classList.add('classified'); // ì´ˆê¸°í™”ìš© í´ë˜ìŠ¤
                    
                    classifiedCount++;
                    
                    // [ë¶„ë¥˜ ì™„ë£Œ í™•ì¸]
                    if (classifiedCount === solutionLabels.length) {
                        knowledgePoint.classList.add('show');
                        labelPoolContainer.style.display = 'none'; // ì´ë¦„í‘œ í’€ ìˆ¨ê¸°ê¸°
                    }
                } else {
                    // ì˜¤ë‹µ (ì•„ë¬´ê²ƒë„ ì•ˆí•¨, íŠ•ê²¨ë‚˜ê°„ íš¨ê³¼)
                }
            }


            // =================================================
            // === 3. ê³µí†µ ë“œë¡­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ë§ˆìš°ìŠ¤/í„°ì¹˜) ===
            // =================================================

            // 3-1. ê³µí†µ ë“œë¡­ ì¡´ (ë§ˆìš°ìŠ¤)
            document.addEventListener('dragover', (e) => {
                e.preventDefault(); 
                // ë“œë¡­ ê°€ëŠ¥í•œ ëŒ€ìƒ: í™ˆ(well) ë˜ëŠ” ê²°ê³¼ ê·¸ë£¹(result-group)
                const dropTarget = e.target.closest('.well, .result-group');
                
                // ê¸°ì¡´ .drag-over ëª¨ë‘ ì œê±°
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                if (dropTarget) {
                    // ì§€ì‹œì•½ì„ í™ˆ(well) ìœ„ë¡œ ë“œë˜ê·¸í•  ë•Œ
                    if (draggedType === 'indicator' && dropTarget.classList.contains('well')) {
                        // (CSS í”¼ë“œë°± ì—†ìŒ)
                    } 
                    // ì´ë¦„í‘œë¥¼ ê²°ê³¼ ê·¸ë£¹(result-group) ìœ„ë¡œ ë“œë˜ê·¸í•  ë•Œ
                    else if (draggedType === 'label' && dropTarget.classList.contains('result-group')) {
                        dropTarget.classList.add('drag-over'); 
                    }
                }
            });

            document.addEventListener('drop', (e) => {
                e.preventDefault();
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

                const dropTarget = e.target;
                
                if (draggedType === 'indicator') {
                    runIndicatorDrop(dropTarget);
                } else if (draggedType === 'label') {
                    const dropZone = dropTarget.closest('.result-group');
                    if (dropZone) {
                        runClassificationDrop(dropZone, draggedElement);
                    }
                }
            });

            // 3-2. ê³µí†µ í„°ì¹˜ ì´ë™/ì¢…ë£Œ
            document.addEventListener('touchmove', (e) => {
                if (!isTouchDragging || !ghostElement) return;
                e.preventDefault(); 
                
                const touch = e.touches[0];
                updateGhostPosition(touch, ghostElement);
                
                // í„°ì¹˜ ìœ„ì¹˜ì˜ ìš”ì†Œ ì°¾ê¸°
                const elementUnderTouch = document.elementFromPoint(touch.clientX, touch.clientY);
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
                
                if (draggedType === 'label') {
                    const dropZone = elementUnderTouch ? elementUnderTouch.closest('.result-group') : null;
                    if (dropZone) {
                        dropZone.classList.add('drag-over');
                    }
                }
                // (ì§€ì‹œì•½ì€ í„°ì¹˜ ë“œë˜ê·¸ ì˜¤ë²„ í”¼ë“œë°± ì—†ìŒ)
                
            }, { passive: false });

            document.addEventListener('touchend', (e) => {
                if (!isTouchDragging) return;
                isTouchDragging = false;
                
                document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));

                const touch = e.changedTouches[0];
                // í„°ì¹˜ë¥¼ ë—€ ìœ„ì¹˜ì˜ ìš”ì†Œ ì°¾ê¸°
                const dropTarget = document.elementFromPoint(touch.clientX, touch.clientY);
                
                // ìœ ë ¹ ìš”ì†Œ ì œê±°
                if (ghostElement) document.body.removeChild(ghostElement);
                ghostElement = null;

                if (dropTarget) {
                    if (draggedType === 'indicator') {
                        runIndicatorDrop(dropTarget);
                    } else if (draggedType === 'label') {
                        const dropZone = dropTarget.closest('.result-group');
                        if (dropZone) {
                            runClassificationDrop(dropZone, draggedElement);
                        }
                    }
                }
                
                draggedElement = null;
                draggedType = null;
                
                checkPulseState(); // [NEW] í„°ì¹˜ ì¢…ë£Œ ì‹œ ë°˜ì§ì„ ìƒíƒœ ì¬í™•ì¸
            });

            // 3-3. ìœ ë ¹ ìš”ì†Œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ (ê³µí†µ)
            function updateGhostPosition(touch, ghostEl) {
                if (!ghostEl) return;
                ghostEl.style.left = `${touch.clientX}px`;
                ghostEl.style.top = `${touch.clientY}px`;
            }


            // ================================
            // === 4. ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ ===
            // ================================
            
            // 4-1. ë¶„ë¥˜ ì˜ì—­ í‘œì‹œ í•¨ìˆ˜
            function showClassificationArea() {
                resultsArea.classList.add('show'); 
                labelPoolContainer.style.display = 'block'; // ì´ë¦„í‘œ í’€ ë³´ì´ê¸°
                knowledgePoint.classList.remove('show'); // 'ì•Œê²Œ ëœ ì 'ì€ ìˆ¨ê¸°ê¸°
                
                // [NEW] ì´ë¦„í‘œë“¤ì— ë°˜ì§ì„ íš¨ê³¼ ì¶”ê°€
                checkPulseState();
            }

            // 4-2. ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸
            resetButton.addEventListener('click', () => {
                // 1. ì§€ì‹œì•½ ì‹¤í—˜ ë¦¬ì…‹
                indicatorColoredCount = 0;
                wells.forEach(well => {
                    const solutionDiv = well.querySelector('.solution');
                    solutionDiv.style.removeProperty('--solution-color');
                    delete solutionDiv.dataset.colored;
                    solutionDiv.style.backgroundColor = ''; // ê¸°ë³¸ ë°°ê²½ìƒ‰ìœ¼ë¡œ
                });

                // 2. ë¶„ë¥˜ ì‹¤í—˜ ë¦¬ì…‹
                classifiedCount = 0;
                resultsArea.classList.remove('show');
                labelPoolContainer.style.display = 'none';
                knowledgePoint.classList.remove('show');
                
                acidList.innerHTML = '';
                baseList.innerHTML = '';
                
                solutionLabels.forEach(label => {
                    label.style.display = 'inline-flex'; // ìˆ¨ê²¼ë˜ ì´ë¦„í‘œ ë‹¤ì‹œ ë³´ì´ê¸°
                    label.classList.remove('classified');
                });
                
                // [NEW] ë¦¬ì…‹ í›„ ë°˜ì§ì„ ìƒíƒœ ì¬ì„¤ì • (ì§€ì‹œì•½ì´ ë‹¤ì‹œ ë°˜ì§ì´ë„ë¡)
                checkPulseState();
            });
            
            // [NEW] í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë°˜ì§ì„ ì ìš©
            checkPulseState();

        });
    </script>
</body>
</html>
